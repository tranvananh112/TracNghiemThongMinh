<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Supabase - ƒê∆°n Gi·∫£n</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: 500;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .results {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
        }

        .quiz-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .quiz-item strong {
            color: #667eea;
            font-size: 16px;
        }

        .quiz-item small {
            color: #666;
            display: block;
            margin-top: 5px;
        }

        pre {
            background: #2d3748;
            color: #68d391;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>
            <span>üß™</span>
            Test K·∫øt N·ªëi Supabase
        </h1>
        <p class="subtitle">Ki·ªÉm tra k·∫øt n·ªëi v√† d·ªØ li·ªáu trong Supabase</p>

        <div id="status"></div>

        <div class="buttons">
            <button onclick="testConnection()">
                <span>üîç</span>
                Ki·ªÉm Tra K·∫øt N·ªëi
            </button>
            <button onclick="testGetAllQuizzes()" class="btn-success">
                <span>üìã</span>
                L·∫•y T·∫•t C·∫£ Quiz
            </button>
            <button onclick="testCreateQuiz()" class="btn-success">
                <span>‚ûï</span>
                T·∫°o Quiz Test
            </button>
            <button onclick="testDeleteAllQuizzes()" class="btn-danger">
                <span>üóëÔ∏è</span>
                X√≥a Quiz Test
            </button>
        </div>

        <div id="results" class="results" style="display: none;"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://uyjakelguelunqzdbscb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5amFrZWxndWVsdW5xemRic2NiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNjE4MDQsImV4cCI6MjA4MTYzNzgwNH0.TdZm16WGlB35vla_wKaoHwMLfCrUirY-EN46olOFyyk';

        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function showResults(content) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = content;
        }

        async function testConnection() {
            showStatus('üîÑ ƒêang ki·ªÉm tra k·∫øt n·ªëi...', 'info');

            try {
                const { data, error, count } = await supabaseClient
                    .from('shared_quizzes')
                    .select('*', { count: 'exact', head: true });

                if (error) {
                    showStatus('‚ùå L·ªói k·∫øt n·ªëi: ' + error.message, 'error');
                    showResults(`<pre>${JSON.stringify(error, null, 2)}</pre>`);
                } else {
                    showStatus(`‚úÖ K·∫øt n·ªëi Supabase th√†nh c√¥ng! C√≥ ${count || 0} quiz trong database.`, 'success');
                    showResults(`<pre>K·∫øt n·ªëi OK!\nS·ªë quiz: ${count || 0}</pre>`);
                }
            } catch (error) {
                showStatus('‚ùå L·ªói: ' + error.message, 'error');
                showResults(`<pre>${JSON.stringify(error, null, 2)}</pre>`);
            }
        }

        async function testGetAllQuizzes() {
            showStatus('üîÑ ƒêang l·∫•y danh s√°ch quiz...', 'info');

            try {
                const { data, error } = await supabaseClient
                    .from('shared_quizzes')
                    .select('*')
                    .order('shared_at', { ascending: false })
                    .limit(50);

                if (error) {
                    showStatus('‚ùå L·ªói: ' + error.message, 'error');
                    showResults(`<pre>${JSON.stringify(error, null, 2)}</pre>`);
                } else {
                    showStatus(`‚úÖ T√¨m th·∫•y ${data.length} quiz trong Supabase`, 'success');

                    if (data.length === 0) {
                        showResults(`
                            <div class="status warning">
                                ‚ö†Ô∏è Kh√¥ng c√≥ quiz n√†o trong database.<br>
                                H√£y click "‚ûï T·∫°o Quiz Test" ƒë·ªÉ t·∫°o quiz m·∫´u!
                            </div>
                        `);
                    } else {
                        let html = '<h3 style="color: #667eea; margin-bottom: 15px;">üìö Danh s√°ch Quiz:</h3>';
                        data.forEach((quiz, index) => {
                            html += `
                                <div class="quiz-item">
                                    <strong>${index + 1}. ${quiz.title}</strong>
                                    <small>üë§ Ng∆∞·ªùi t·∫°o: ${quiz.user_name}</small>
                                    <small>üìù S·ªë c√¢u: ${quiz.total_questions}</small>
                                    <small>üëÅÔ∏è L∆∞·ª£t xem: ${quiz.views || 0} | üìä L∆∞·ª£t l√†m: ${quiz.attempts || 0}</small>
                                    <small>üÜî ID: ${quiz.id}</small>
                                </div>
                            `;
                        });
                        showResults(html);
                    }
                }
            } catch (error) {
                showStatus('‚ùå L·ªói: ' + error.message, 'error');
                showResults(`<pre>${JSON.stringify(error, null, 2)}</pre>`);
            }
        }

        async function testCreateQuiz() {
            showStatus('üîÑ ƒêang t·∫°o quiz test...', 'info');

            try {
                const testQuiz = {
                    title: 'üß™ Quiz Test - ' + new Date().toLocaleString('vi-VN'),
                    description: 'ƒê√¢y l√† quiz test ƒë·ªÉ ki·ªÉm tra k·∫øt n·ªëi Supabase',
                    questions: [
                        {
                            question: 'Supabase l√† g√¨?',
                            answers: ['Database', 'Backend as a Service', 'Cloud Storage', 'T·∫•t c·∫£ ƒë·ªÅu ƒë√∫ng'],
                            correctAnswer: 3
                        },
                        {
                            question: 'Supabase s·ª≠ d·ª•ng database n√†o?',
                            answers: ['MySQL', 'PostgreSQL', 'MongoDB', 'SQLite'],
                            correctAnswer: 1
                        }
                    ],
                    total_questions: 2,
                    user_name: 'Test User',
                    views: 0,
                    attempts: 0,
                    likes: 0,
                    tags: ['test', 'supabase'],
                    difficulty: 'easy',
                    category: 'test'
                };

                const { data, error } = await supabaseClient
                    .from('shared_quizzes')
                    .insert([testQuiz])
                    .select()
                    .single();

                if (error) {
                    showStatus('‚ùå L·ªói t·∫°o quiz: ' + error.message, 'error');
                    showResults(`<pre>${JSON.stringify(error, null, 2)}</pre>`);
                } else {
                    showStatus('‚úÖ ƒê√£ t·∫°o quiz test th√†nh c√¥ng!', 'success');
                    showResults(`
                        <div class="quiz-item">
                            <strong>‚ú® Quiz v·ª´a t·∫°o:</strong>
                            <small>üìù ${data.title}</small>
                            <small>üÜî ID: ${data.id}</small>
                        </div>
                    `);

                    // T·ª± ƒë·ªông load l·∫°i danh s√°ch sau 1 gi√¢y
                    setTimeout(() => testGetAllQuizzes(), 1000);
                }
            } catch (error) {
                showStatus('‚ùå L·ªói: ' + error.message, 'error');
                showResults(`<pre>${JSON.stringify(error, null, 2)}</pre>`);
            }
        }

        async function testDeleteAllQuizzes() {
            if (!confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a T·∫§T C·∫¢ quiz test?\n(Ch·ªâ x√≥a quiz c√≥ ti√™u ƒë·ªÅ ch·ª©a "Quiz Test")')) {
                return;
            }

            showStatus('üîÑ ƒêang x√≥a quiz test...', 'info');

            try {
                const { data, error } = await supabaseClient
                    .from('shared_quizzes')
                    .delete()
                    .ilike('title', '%Quiz Test%')
                    .select();

                if (error) {
                    showStatus('‚ùå L·ªói x√≥a: ' + error.message, 'error');
                    showResults(`<pre>${JSON.stringify(error, null, 2)}</pre>`);
                } else {
                    showStatus(`‚úÖ ƒê√£ x√≥a ${data.length} quiz test`, 'success');
                    showResults(`<pre>ƒê√£ x√≥a ${data.length} quiz test th√†nh c√¥ng!</pre>`);

                    // T·ª± ƒë·ªông load l·∫°i danh s√°ch sau 1 gi√¢y
                    setTimeout(() => testGetAllQuizzes(), 1000);
                }
            } catch (error) {
                showStatus('‚ùå L·ªói: ' + error.message, 'error');
                showResults(`<pre>${JSON.stringify(error, null, 2)}</pre>`);
            }
        }

        // Auto test khi load trang
        window.addEventListener('load', () => {
            console.log('üöÄ Page loaded, testing connection...');
            testConnection();
        });
    </script>
</body>

</html>